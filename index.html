<!doctype html>
<html lang="sv">
<head>
    <meta charset="utf-8" />
    <title>BVX Kostnadsverktyg</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@600&display=swap" rel="stylesheet" />

    <style>
        :root {
            --bg: #f5f7fa;
            --fg: #1d2b38;
            --muted: #6c7a89;
            --card: #ffffff;
            --accent: #4a90e2;
            --accent-2: #3a7bd5;
            --border: #e0e6ed;
            --ok-bg: #d9e9f2;
            --ok-bd: #a3c4db;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background: var(--bg);
            color: var(--fg);
            line-height: 1.6;
            box-sizing: border-box;
        }
        
        * { box-sizing: inherit; }

        header {
            background: var(--fg);
            color: #fff;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        h1, h2 {
            font-family: 'Poppins', sans-serif;
            margin: 0 0 12px;
            padding: 0;
        }

        h1 {
            font-size: 2.2em;
            letter-spacing: -0.5px;
        }

        h2 {
            color: var(--muted);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
            font-size: 1.5em;
        }

        .container {
            display: grid;
            gap: 24px;
            padding: 24px;
            grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
        }

        .card {
            background: var(--card);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .08);
            padding: 30px;
            border: 1px solid var(--border);
        }

        fieldset {
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin: 0 0 20px;
        }

        legend {
            padding: 0 8px;
            color: var(--muted);
            font-weight: 600;
        }

        .grid {
            display: grid;
            gap: 16px;
            grid-template-columns: 1fr 1fr;
        }

        .grid .full {
            grid-column: 1/-1;
        }

        label {
            font-weight: 600;
            display: block;
            margin-bottom: 6px;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #cfd6de;
            border-radius: 10px;
            font-size: 16px;
            background: #fff;
            font-family: inherit;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        }

        .actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        button {
            padding: 12px 20px;
            background: var(--accent);
            color: #fff;
            border: 0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background .2s, transform .1s;
        }

        button.secondary {
            background: #aab5c1;
        }

        button:hover {
            background: var(--accent-2);
        }

        button.secondary:hover {
            background: #8e9ca8;
        }

        button:active {
            transform: scale(0.98);
        }

        .result {
            background: var(--ok-bg);
            padding: 20px;
            border: 1px solid var(--ok-bd);
            border-radius: 12px;
            font-size: 16px;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin: 8px 0;
            padding: 4px 0;
        }

        .muted {
            color: #5f6c7b;
            font-size: 14px;
        }

        .footer {
            text-align: center;
            font-size: 12px;
            color: #6c7a89;
            padding: 20px 0 30px;
        }

        .signatures {
            display: none;
        }
        
        .signature-row {
            display: flex;
            justify-content: space-between;
            gap: 40px;
            margin-top: 50px;
        }

        .signature-item {
            width: 100%;
            border-top: 1px solid #000;
            padding-top: 8px;
            font-size: 11pt;
            line-height: 1.3;
        }
        
        /* -- UTSKRIFTSSTILAR -- */
        @media print {
            body {
                background: #fff;
                font-size: 10pt;
                color: #000;
                margin: 0;
            }
            header, .footer, .actions, .no-print {
                display: none !important;
            }
            .container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
                padding: 12px;
            }
            .card {
                box-shadow: none;
                border: 1px solid #ccc;
                padding: 12px;
                margin: 0;
                page-break-inside: avoid;
            }
            h2 {
                font-size: 14pt;
                margin-bottom: 8px;
            }
            fieldset {
                padding: 8px;
                margin-bottom: 8px;
            }
            input, select {
                padding: 5px;
                font-size: 9pt;
            }
            .result-row {
                padding: 1px 0;
                margin: 2px 0;
            }
            .signatures {
                display: block;
                padding-top: 20px;
            }
            .signatures h2 {
                margin-bottom: 8px;
            }
            .signature-row {
                margin-top: 30px;
            }
        }
    </style>
</head>
<body>
    <header><h1>BVX Kostnadsverktyg</h1></header>

    <main class="container">
        <section class="card">
            <h2>Förutsättningar och aktörer</h2>
            <form id="bvx-form" novalidate>
                <fieldset>
                    <legend>Kontakt</legend>
                    <div class="grid">
                        <div>
                            <label for="chef">Chefens namn</label>
                            <input id="chef" name="chef" type="text" placeholder="För- och efternamn" autocomplete="name" />
                        </div>
                        <div>
                            <label for="arbetsplats">Arbetsplats</label>
                            <input id="arbetsplats" name="arbetsplats" type="text" placeholder="Enhet/arbetsplats" />
                        </div>
                        <div>
                            <label for="ame">AME</label>
                            <input id="ame" name="ame" type="text" placeholder="För- och efternamn" />
                        </div>
                        <div>
                            <label for="kandidat">Kandidat</label>
                            <input id="kandidat" name="kandidat" type="text" pattern="[0-9]{5}" maxlength="5" placeholder="Kundnummer" />
                        </div>
                        <div>
                            <label for="datum">Datum</label>
                            <input id="datum" name="datum" type="date" required />
                        </div>
                        <div>
                            <label for="kontakt">Kontaktuppgifter</label>
                            <input id="kontakt" name="kontakt" type="text" placeholder="Telefon / e‑post" />
                        </div>
                        <div>
                            <label for="startdatum">Anst. startdatum</label>
                            <input id="startdatum" name="startdatum" type="date" />
                        </div>
                        <div>
                            <label for="slutdatum">Anst. slutdatum</label>
                            <input id="slutdatum" name="slutdatum" type="date" />
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Ekonomi</legend>
                    <div class="grid">
                        <div>
                            <label for="bruttolon">Bruttolön (kr/mån)</label>
                            <input id="bruttolon" type="number" min="0" step="100" value="22500" required />
                        </div>
                        <div>
                            <label for="agavgift">Arbetsgivaravgift (%)</label>
                            <input id="agavgift" type="number" min="0" max="100" step="0.01" value="31.42" required />
                        </div>
                        <div>
                            <label for="stodform">Stödform Af</label>
                            <select id="stodform">
                                <option value="ny-1x">Nystart 1x</option>
                                <option value="ny-2x">Nystart 2x</option>
                                <option value="ny-2.5x">Nystart 2.5x</option>
                                <option value="introduktion">Introduktionsjobb</option>
                                <option value="0">Inget stöd</option>
                            </select>
                        </div>
                        <div>
                            <label for="socstod"> Stöd IFO (kr/mån)</label>
                            <input id="socstod" type="number" min="0" step="100" value="12000" />
                        </div>
                    </div>
                </fieldset>
                
                <div class="actions no-print">
                    <button type="submit">Beräkna</button>
                </div>
                <p class="muted no-print">Tips: Fälten sparas lokalt i din webbläsare.</p>
                
            </form>
        </section>

        <section class="card">
            <h2>Resultat</h2>
            <div id="resultat" class="result" aria-live="polite" aria-atomic="true">
                Fyll i uppgifterna; resultatet uppdateras automatiskt.
            </div>

            <p class="muted no-print">Belopp visas per månad i SEK.</p>

            <div class="actions" id="result-actions">
                <button type="button" id="btn-print">Spara som PDF / Skriv ut</button>
                <button type="button" id="btn-reset" class="secondary">Rensa</button>
            </div>
        </section>
    </main>

    <div class="signatures">
        <h2>Överenskommelse om bidragsväxling</h2>
        <p>Denna överenskommelse om bidragsväxling är ett samarbete mellan:</p>
	<br>
	<br>
        <div class="signature-row">
            <div class="signature-item">
                <p><strong>IFO</strong></p>
                <p>Namnförtydligande: <span id="sign-ame"></span></p>
            </div>
            <div class="signature-item">
                <p><strong>Arbetsgivare</strong></p>
                <p>Namnförtydligande: <span id="sign-chef"></span></p>
            </div>
        </div>
        <p>Datum: <span id="sign-datum"></span></p>
    </div>

    <div class="footer">Överenskommelse Bidragsväxling – genererad lokalt i din webbläsare.</div>

    <script>
        // ------- Hjälp & beräkning -------
        const SEK = new Intl.NumberFormat('sv-SE',{style:'currency',currency:'SEK',maximumFractionDigits:0});
        const fmt = v => SEK.format(Math.round(v||0));
        const num = (v,f=0) => { const x = parseFloat(String(v).replace(/\s/g,'')); return Number.isFinite(x)?x:f; };

        function compute({lon, agPct, afStod, socStod}) {
            const agBelopp = Math.max(0,lon) * Math.max(0,agPct) / 100;
            
            let afBelopp = 0;
            switch(afStod) {
                case 'ny-1x':
                    afBelopp = agBelopp;
                    break;
                case 'ny-2x':
                    afBelopp = agBelopp * 2;
                    break;
                case 'ny-2.5x':
                    afBelopp = agBelopp * 2.5;
                    break;
                case 'introduktion':
                    afBelopp = lon * 0.8;
                    break;
            }

            const totalKostnad = Math.max(0,lon) + agBelopp;
            const totalStod = Math.max(0,afBelopp) + Math.max(0,socStod);
            const slutkostnad = Math.max(0,totalKostnad - totalStod);
            
            return {agBelopp,totalKostnad,totalStod,slutkostnad};
        }

        function renderResult(r){
            document.getElementById('resultat').innerHTML = `
                <div class="result-row"><strong>Arbetsgivaravgift:</strong><span>${fmt(r.agBelopp)} / mån</span></div>
                <div class="result-row"><strong>Total kostnad:</strong><span>${fmt(r.totalKostnad)} / mån</span></div>
                <div class="result-row"><strong>Totalt stöd:</strong><span>${fmt(r.totalStod)} / mån</span></div>
                <div class="result-row"><strong>Slutgiltig kostnad:</strong><span>${fmt(r.slutkostnad)} / mån</span></div>
            `;
        }

        function updateSignatures(data) {
            document.getElementById('sign-chef').textContent = data.chef || '';
            document.getElementById('sign-ame').textContent = data.ame || '';
            document.getElementById('sign-datum').textContent = data.datum || '';
        }

        function readForm(){
            return {
                chef: document.getElementById('chef').value.trim(),
                arbetsplats: document.getElementById('arbetsplats').value.trim(),
                ame: document.getElementById('ame').value.trim(),
                kandidat: document.getElementById('kandidat').value.trim(),
                datum: document.getElementById('datum').value,
                kontakt: document.getElementById('kontakt').value.trim(),
                startdatum: document.getElementById('startdatum').value,
                slutdatum: document.getElementById('slutdatum').value,
                lon: num(document.getElementById('bruttolon').value,0),
                agPct: num(document.getElementById('agavgift').value,0),
                afStod: document.getElementById('stodform').value,
                socStod: num(document.getElementById('socstod').value,0),
                stodformText: document.getElementById('stodform').selectedOptions[0]?.text || ''
            };
        }
        
        function performCalc(e){
            if(e) e.preventDefault();
            const data = readForm();
            const result = compute(data);
            renderResult(result);
            updateSignatures(data);
            try{ localStorage.setItem('bvx-data', JSON.stringify(data)); }catch{}
        }
        
        function loadFromStorage() {
            try {
                const savedData = JSON.parse(localStorage.getItem('bvx-data'));
                if (savedData) {
                    Object.keys(savedData).forEach(key => {
                        const el = document.getElementById(key);
                        if (el) el.value = savedData[key];
                    });
                }
            } catch {}
        }

        // ------- Event Listeners -------
        const formEl = document.getElementById('bvx-form');
        formEl.addEventListener('input', performCalc);
        formEl.addEventListener('submit', performCalc);

        document.getElementById('btn-print').addEventListener('click', () => {
            window.print();
        });
        
        document.getElementById('btn-reset').addEventListener('click', ()=>{
            if (confirm('Är du säker på att du vill rensa alla fält?')) {
                localStorage.removeItem('bvx-data');
                formEl.reset();
                document.getElementById('datum').value = new Date().toISOString().slice(0, 10);
                document.getElementById('resultat').textContent = 'Fyll i uppgifterna; resultatet uppdateras automatiskt.';
                performCalc();
            }
        });

        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('datum').value = new Date().toISOString().slice(0, 10);
            loadFromStorage();
            performCalc();
        });
    </script>
</body>
</html>
